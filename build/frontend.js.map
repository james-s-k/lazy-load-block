{"version":3,"file":"frontend.js","mappings":"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","sources":["webpack://lazy-load-block/./src/frontend.js"],"sourcesContent":["/**\n * Frontend JavaScript for the Lazy Load Block\n * Handles intersection observation and dynamic content loading\n */\ndocument.addEventListener(\"DOMContentLoaded\", function () {\n    // Track loaded blocks to prevent duplicate loading\n    const loadedBlocks = new Set();\n\n    // Create a single IntersectionObserver instance\n    const observer = new IntersectionObserver((entries, obs) => {\n        entries.forEach(entry => {\n            if (!entry.isIntersecting) return;\n\n            const block = entry.target;\n            const blockId = block.getAttribute(\"data-block-id\");\n\n            // Skip if block is already loaded or currently loading\n            if (loadedBlocks.has(blockId) || block.dataset.loading) {\n                return;\n            }\n\n            // Mark block as loading and add to loaded set\n            block.dataset.loading = \"true\";\n            loadedBlocks.add(blockId);\n\n            // Add loading spinner if enabled\n            if (block.getAttribute('data-show-spinner') === 'true') {\n                addSpinner(block);\n            }\n\n            loadBlock(block);\n            obs.unobserve(block);\n\n            // Disconnect observer if all blocks are loaded\n            if (loadedBlocks.size === document.querySelectorAll(\".wp-block-strive-lazy-load-block\").length) {\n                obs.disconnect();\n            }\n        });\n    }, {\n        rootMargin: '50px 0px',\n        threshold: 0.1\n    });\n\n    // Observe all lazy load blocks\n    document.querySelectorAll(\".wp-block-strive-lazy-load-block\").forEach(block => {\n        observer.observe(block);\n    });\n});\n\n/**\n * Adds a loading spinner to the block\n */\nfunction addSpinner(block) {\n    // Get all spinner attributes once with defaults\n    const spinnerConfig = {\n        size: parseInt(block.getAttribute('data-spinner-size')) || 40,\n        border: parseInt(block.getAttribute('data-spinner-border')) || 4,\n        primaryColor: block.getAttribute('data-spinner-primary') || '#c214bf',\n        secondaryColor: block.getAttribute('data-spinner-secondary') || '#290529'\n    };\n    \n    // Create spinner container with specified size\n    const spinnerContainer = document.createElement(\"div\");\n    spinnerContainer.className = \"llb-spinner-container\";\n    spinnerContainer.style.width = `${spinnerConfig.size}px`;\n    spinnerContainer.style.height = `${spinnerConfig.size}px`;\n    \n    // Create and style the spinner element\n    const spinner = document.createElement(\"div\");\n    spinner.className = \"llb-spinner\";\n    spinner.style.width = '100%';\n    spinner.style.height = '100%';\n    spinner.style.borderWidth = `${spinnerConfig.border}px`;\n    spinner.style.borderStyle = 'solid';\n    spinner.style.borderTopColor = spinnerConfig.primaryColor;\n    spinner.style.borderRightColor = spinnerConfig.secondaryColor;\n    spinner.style.borderBottomColor = spinnerConfig.secondaryColor;\n    spinner.style.borderLeftColor = spinnerConfig.secondaryColor;\n    \n    spinnerContainer.appendChild(spinner);\n    block.appendChild(spinnerContainer);\n}\n\n/**\n * Loads block content via AJAX with retry functionality\n */\nfunction loadBlock(block, retryCount = 0) {\n    const MAX_RETRIES = 3;\n    const RETRY_DELAY = 2000; // 2 seconds\n    const blockId = block.getAttribute(\"data-block-id\");\n    \n    // Make AJAX request to load block content\n    const formData = new FormData();\n    formData.append('action', 'lazy_load_block_content');\n    formData.append('block_id', blockId);\n    formData.append('nonce', lazyBlockAjax.nonce);\n\n    // Create AbortController for timeout\n    const controller = new AbortController();\n    const timeout = setTimeout(() => controller.abort(), 10000); // 10 second timeout\n\n    fetch(lazyBlockAjax.ajax_url, {\n        method: 'POST',\n        credentials: 'same-origin',\n        body: formData,\n        signal: controller.signal\n    })\n    .then(response => {\n        clearTimeout(timeout);\n        if (!response.ok) {\n            throw new Error(`HTTP error! status: ${response.status}`);\n        }\n        return response.json();\n    })\n    .then(data => {\n        if (data.success && data.content) {\n            handleSuccessfulLoad(block, data);\n        } else {\n            throw new Error(data.message || 'Failed to load block content');\n        }\n    })\n    .catch(error => {\n        // Comment out error logging\n        /*console.error('Error loading block content:', error);*/\n        \n        // Reset loading state\n        block.dataset.loading = \"false\";\n        loadedBlocks.delete(blockId);\n\n        // Retry if under max attempts\n        if (retryCount < MAX_RETRIES) {\n            /*console.log(`Retrying load (${retryCount + 1}/${MAX_RETRIES})...`);*/\n            setTimeout(() => {\n                loadBlock(block, retryCount + 1);\n            }, RETRY_DELAY);\n        } else {\n            /*console.error('Max retries reached, showing error message');*/\n            showErrorState(block, 'Unable to load content. Try refreshing the page.');\n        }\n    });\n}\n\n/**\n * Handles successful block load\n */\nfunction handleSuccessfulLoad(block, data) {\n    // Create temporary container to parse content\n    const temp = document.createElement('div');\n    temp.innerHTML = data.content;\n\n    // Handle embeds specially\n    const embeds = temp.querySelectorAll('iframe[src*=\"youtube.com\"], iframe[src*=\"vimeo.com\"]');\n    embeds.forEach(embed => {\n        // Clean up iframe attributes\n        const allowedAttributes = ['src', 'width', 'height', 'title', 'frameborder', 'allow'];\n        Array.from(embed.attributes).forEach(attr => {\n            if (!allowedAttributes.includes(attr.name)) {\n                embed.removeAttribute(attr.name);\n            }\n        });\n        \n        // Set secure and privacy-focused attributes\n        embed.setAttribute('loading', 'lazy');\n        embed.setAttribute('frameborder', '0');\n        embed.setAttribute('allow', 'encrypted-media; web-share');\n    });\n\n    // Remove loading state and spinner\n    block.dataset.loading = \"false\";\n    const spinner = block.querySelector('.llb-spinner-container');\n    if (spinner) {\n        spinner.remove();\n    }\n\n    // Add the loaded content to the block\n    block.innerHTML = temp.innerHTML;\n\n    // Add debug info if available\n    if (data.debug) {\n        const debugInfo = document.createElement('div');\n        debugInfo.className = 'llb-debug-info';\n        debugInfo.innerHTML = data.debug;\n        block.appendChild(debugInfo);\n    }\n\n    // Ensure all required CSS variables are set\n    if (lazyBlockAjax.cssVars) {\n        Object.entries(lazyBlockAjax.cssVars).forEach(([variable, value]) => {\n            document.documentElement.style.setProperty(variable, value);\n        });\n    }\n\n    // Re-trigger WordPress block initialization\n    if (typeof wp !== 'undefined' && wp.blocks && wp.blocks.getBlockTypes) {\n        const galleries = block.querySelectorAll('.wp-block-gallery');\n        galleries.forEach(gallery => {\n            // Remove and re-add the gallery class to trigger WordPress's initialization\n            const classes = gallery.className;\n            gallery.className = '';\n            void gallery.offsetWidth; // Force reflow\n            gallery.className = classes;\n        });\n    }\n\n    // Force a reflow before adding animation classes\n    void block.offsetWidth;\n    \n    // Set animation duration from block attributes\n    block.style.setProperty('--animation-duration', \n        `${block.getAttribute('data-animation-duration')}ms`);\n    \n    // Add loaded class to trigger animation\n    block.classList.add(\"loaded\");\n}\n\n/**\n * Shows error state in block\n */\nfunction showErrorState(block, message = 'Failed to load content. Please refresh the page.') {\n    const errorMessage = document.createElement('div');\n    errorMessage.className = 'lazy-block-error';\n    errorMessage.innerHTML = `\n        <p>${message}</p>\n        <button onclick=\"location.reload()\">Refresh Page</button>\n    `;\n    block.innerHTML = '';\n    block.appendChild(errorMessage);\n    block.classList.add('error');\n} "],"names":["document","addEventListener","loadedBlocks","Set","observer","IntersectionObserver","entries","obs","forEach","entry","isIntersecting","block","target","blockId","getAttribute","has","dataset","loading","add","addSpinner","loadBlock","unobserve","size","querySelectorAll","length","disconnect","rootMargin","threshold","observe","spinnerConfig","parseInt","border","primaryColor","secondaryColor","spinnerContainer","createElement","className","style","width","height","spinner","borderWidth","borderStyle","borderTopColor","borderRightColor","borderBottomColor","borderLeftColor","appendChild","retryCount","MAX_RETRIES","RETRY_DELAY","formData","FormData","append","lazyBlockAjax","nonce","controller","AbortController","timeout","setTimeout","abort","fetch","ajax_url","method","credentials","body","signal","then","response","clearTimeout","ok","Error","status","json","data","success","content","handleSuccessfulLoad","message","catch","error","delete","showErrorState","temp","innerHTML","embeds","embed","allowedAttributes","Array","from","attributes","attr","includes","name","removeAttribute","setAttribute","querySelector","remove","debug","debugInfo","cssVars","Object","variable","value","documentElement","setProperty","wp","blocks","getBlockTypes","galleries","gallery","classes","offsetWidth","classList","errorMessage"],"sourceRoot":""}